<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1~9 Ïπ¥Îìú ÎåÄÏ†Ñ - Ï†ÑÎûµÏ†Å Ïò®ÎùºÏù∏ Ïπ¥Îìú Í≤åÏûÑ</title>
    
    <!-- Open Graph Î©îÌÉÄ ÌÉúÍ∑∏ -->
    <meta property="og:title" content="üéÆ 1~9 Ïπ¥Îìú ÎåÄÏ†Ñ">
    <meta property="og:description" content="Ï†ÑÎûµÏ†Å Ïπ¥Îìú Í≤åÏûÑÏúºÎ°ú ÏäπÎ∂ÄÌïòÏÑ∏Ïöî! 1ÏùÄ 9Î•º Ïù¥Í∏∞Îäî ÌäπÎ≥ÑÌïú Í∑úÏπôÏù¥ ÏûàÎäî Ïû¨ÎØ∏ÏûàÎäî Ïò®ÎùºÏù∏ Í≤åÏûÑÏûÖÎãàÎã§.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://onetonine.tomomi.ai.kr">
    <meta property="og:image" content="https://onetonine.tomomi.ai.kr/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="1~9 Ïπ¥Îìú ÎåÄÏ†Ñ">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card Î©îÌÉÄ ÌÉúÍ∑∏ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üéÆ 1~9 Ïπ¥Îìú ÎåÄÏ†Ñ">
    <meta name="twitter:description" content="Ï†ÑÎûµÏ†Å Ïπ¥Îìú Í≤åÏûÑÏúºÎ°ú ÏäπÎ∂ÄÌïòÏÑ∏Ïöî! 1ÏùÄ 9Î•º Ïù¥Í∏∞Îäî ÌäπÎ≥ÑÌïú Í∑úÏπôÏù¥ ÏûàÎäî Ïû¨ÎØ∏ÏûàÎäî Ïò®ÎùºÏù∏ Í≤åÏûÑÏûÖÎãàÎã§.">
    <meta name="twitter:image" content="https://onetonine.tomomi.ai.kr/og-image.png">
    
    <!-- Ï∂îÍ∞Ä Î©îÌÉÄ ÌÉúÍ∑∏ -->
    <meta name="description" content="Ï†ÑÎûµÏ†Å Ïπ¥Îìú Í≤åÏûÑÏúºÎ°ú ÏäπÎ∂ÄÌïòÏÑ∏Ïöî! 1ÏùÄ 9Î•º Ïù¥Í∏∞Îäî ÌäπÎ≥ÑÌïú Í∑úÏπôÏù¥ ÏûàÎäî Ïû¨ÎØ∏ÏûàÎäî Ïò®ÎùºÏù∏ Í≤åÏûÑÏûÖÎãàÎã§.">
    <meta name="keywords" content="Ïπ¥ÎìúÍ≤åÏûÑ, Ïò®ÎùºÏù∏Í≤åÏûÑ, Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥, AIÍ≤åÏûÑ, Ï†ÑÎûµÍ≤åÏûÑ, 1-9Ïπ¥ÎìúÎåÄÏ†Ñ">
    <meta name="author" content="1~9 Ïπ¥Îìú ÎåÄÏ†Ñ">
    
    <!-- ÌååÎπÑÏΩò -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            padding: 20px;
        }

        .header {
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1a1a;
            border: 2px solid #333;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-info {
            text-align: left;
        }

        .header h1 {
            font-size: 2.5em;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            margin-bottom: 10px;
        }

        .header p {
            color: #ccc;
            font-size: 1.1em;
        }

        .exit-btn {
            background: #aa0000;
            color: #fff;
            border: 2px solid #cc0000;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exit-btn:hover {
            background: #cc0000;
            border-color: #ff0000;
            transform: translateY(-2px);
        }

        .game-rules {
            margin: 30px 0;
            padding: 25px;
            background: #1a1a1a;
            border: 2px solid #333;
        }

        .rules-header {
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .rules-header:hover {
            background: rgba(0, 255, 255, 0.1);
        }

        .rules-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .rule-section {
            background: #222;
            padding: 20px;
            border: 1px solid #444;
        }

        .rule-section h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .rule-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rule-section li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            color: #e0e0e0;
            line-height: 1.5;
        }

        .rule-section li:before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #00ffff;
        }

        .rule-section strong {
            color: #fff;
        }

        .game-section {
            display: none;
            background: #111;
            padding: 30px;
            border: 2px solid #333;
        }

        .game-section.active {
            display: block;
        }

        .lobby {
            text-align: center;
        }

        .lobby h3 {
            margin-bottom: 30px;
            color: #e0e0e0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 2px solid #444;
            color: #fff;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: linear-gradient(45deg, #00cccc, #0066cc);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .room-info {
            background: #222;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #444;
        }

        .room-code {
            font-size: 1.5em;
            color: #00ffff;
            font-weight: bold;
            text-shadow: 0 0 10px #00ffff;
        }

        .players-list {
            margin: 20px 0;
        }

        .player {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #555;
        }

        .game-area {
            text-align: center;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #222;
            border: 2px solid #444;
        }

        .score {
            text-align: center;
        }

        .score h3 {
            color: #00ffff;
            margin-bottom: 10px;
        }

        .score .number {
            font-size: 2em;
            font-weight: bold;
            color: #fff;
        }

        .round-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .round-info h3 {
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .round-number {
            font-size: 1.5em;
            color: #00ffff;
            font-weight: bold;
        }

        /* Í≤åÏûÑ ÏßÑÌñâ ÏÉÅÌÉú Î¨∏Íµ¨ */
        .status-bar {
            margin: 16px 0;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 2px solid #333;
            color: #e0e0e0;
            text-align: center;
        }

        /* ÏÉàÎ°úÏö¥ Ïπ¥Îìú Ìå®Îìú Ïä§ÌÉÄÏùº */
        .card-pad-section {
            margin: 30px 0;
            padding: 20px;
            background: #1a1a1a;
            border: 2px solid #333;
        }

        .card-pad {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin: 0 auto;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 6px 0;
        }

        .card-button {
            width: 64px;
            height: 84px;
            background: linear-gradient(45deg, #2a2a2a, #4a4a4a);
            border: 3px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: #00ffff;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .card-button:hover {
            background: linear-gradient(45deg, #3a3a3a, #5a5a5a);
            border-color: #00ffff;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        .card-button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.5);
        }

        .card-button.used {
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            border-color: #333;
            color: #666;
            cursor: not-allowed;
            opacity: 0.3;
            transform: none;
        }

        .card-button.used:hover {
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            border-color: #333;
            transform: none;
            box-shadow: none;
        }

        .card-button.selected {
            background: #00aa00;
            color: #fff;
            transform: scale(1.1);
        }

        .card-submit-section {
            margin-top: 20px;
            padding: 15px;
            background: #222;
            border: 1px solid #444;
        }

        /* Í∏∞Ï°¥ Ïπ¥Îìú Ïä§ÌÉÄÏùº Ïà®ÍπÄ */
        .cards-container {
            display: none;
        }

        .card {
            display: none;
        }

        .current-play {
            margin: 30px 0;
            padding: 20px;
            background: #222;
            border: 2px solid #444;
        }

        .play-cards {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .play-card {
            width: 80px;
            height: 100px;
            background: linear-gradient(45deg, #444, #666);
            border: 2px solid #777;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #fff;
        }

        .play-card.played {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: #000;
        }

        .round-result {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border: 2px solid #555;
        }

        .round-result h4 {
            color: #00ffff;
            margin-bottom: 10px;
        }

        .round-result .reason {
            color: #ccc;
            font-size: 1.1em;
        }

        .game-result {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: #222;
            border: 2px solid #444;
        }

        .game-result h2 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .final-scores {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 20px 0;
        }

        .final-score {
            text-align: center;
        }

        .final-score h3 {
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .final-score .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ffff;
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #333;
            border: 2px solid #555;
            color: #fff;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .message.success {
            background: #2d5a2d;
            border-color: #4a7c4a;
            color: #90ee90;
        }

        .message.error {
            background: #5a2d2d;
            border-color: #7c4a4a;
            color: #ff6b6b;
        }

        .message.hidden {
            opacity: 0;
            transform: translateX(100%);
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-info {
                text-align: center;
            }
            
            .exit-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .game-rules {
                margin: 20px 0;
                padding: 0px;
            }
            
            .rules-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .rule-section {
                padding: 15px;
            }
            
            .rule-section h4 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }
            
            /* ÏÉÅÎã® Ï†êÏàòÌåê: Î™®Î∞îÏùºÏóêÏÑúÎèÑ Í∞ÄÎ°ú Î∞∞Ïπò */
            .game-info {
                flex-direction: row;
                gap: 10px;
                align-items: center;
            }
            .score h3 { font-size: 0.95em; }
            .score .number { font-size: 1.6em; }
            .round-number { font-size: 1.2em; }
            
            .play-cards { gap: 12px; }
            .play-card { width: 68px; height: 86px; font-size: 26px; }
            
            /* Ïπ¥Îìú Ìå®Îìú: 2Ï§Ñ Í∑∏Î¶¨Îìú */
            .card-pad {
                display: grid;
                grid-template-columns: repeat(5, minmax(44px, 1fr));
                gap: 10px;
                justify-items: center;
                align-items: center;
                padding: 6px 0;
            }
            .card-button {
                width: 56px;
                height: 72px;
                font-size: 22px;
                border-width: 2px;
            }
            
            .final-scores {
                gap: 30px;
            }
        }
    </style>
        <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body>
    <script>
        // Í≤åÏûÑ Í∑úÏπô ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleRules() {
            const container = document.getElementById('rulesContainer');
            const toggle = document.getElementById('rulesToggle');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggle.textContent = '‚ñ≤';
                toggle.style.transform = 'rotate(180deg)';
            } else {
                container.style.display = 'none';
                toggle.textContent = '‚ñº';
                toggle.style.transform = 'rotate(0deg)';
            }
        }
        
        // Í≤åÏûÑ ÌôîÎ©¥ ÏßÑÏûÖ Ïãú Í∑úÏπô Îã´Í∏∞
        function closeRulesOnGameStart() {
            const container = document.getElementById('rulesContainer');
            const toggle = document.getElementById('rulesToggle');
            
            if (container && toggle) {
                container.style.display = 'none';
                toggle.textContent = '‚ñº';
                toggle.style.transform = 'rotate(0deg)';
            }
        }
    </script>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-info">
                    <h1>üéÆ 1~9 Ïπ¥Îìú ÎåÄÏ†Ñ</h1>
                    <p>Ï†ÑÎûµÏ†Å Ïπ¥Îìú Í≤åÏûÑÏúºÎ°ú ÏäπÎ∂ÄÌïòÏÑ∏Ïöî!</p>
                </div>
                <button id="exitGameBtn" class="exit-btn" style="display: none;">ÎÇòÍ∞ÄÍ∏∞</button>
            </div>
        </div>

        <!-- Î°úÎπÑ ÌôîÎ©¥ -->
        <div id="lobby" class="game-section active">
            <div class="lobby">
                <div id="initialSelection">
                    <h3 style="margin-bottom: 30px; color: #e0e0e0;">Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!</h3>
                    <button id="showCreateRoom" class="btn" style="margin: 10px;">ÏÉà Î∞© ÎßåÎì§Í∏∞</button>
                    <button id="showJoinRoom" class="btn" style="margin: 10px;">Ï¥àÎåÄÏΩîÎìú ÏûÖÎ†•ÌïòÍ∏∞</button>
                    <button id="showAIGame" class="btn" style="margin: 10px; background: linear-gradient(45deg, #ff6b6b, #ee5a24);">ü§ñ AIÏôÄ ÎåÄÏ†Ñ</button>
                </div>

                <div id="createRoomForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #e0e0e0;">ÏÉà Î∞© ÎßåÎì§Í∏∞</h3>
                    <div class="form-group">
                        <label for="createPlayerName">ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ:</label>
                        <input type="text" id="createPlayerName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <button id="createRoomBtn" class="btn">Î∞© ÎßåÎì§Í∏∞</button>
                    <button id="backToSelection" class="btn" style="background: #666;">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>

                <div id="joinRoomForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #e0e0e0;">Î∞© ÏûÖÏû•ÌïòÍ∏∞</h3>
                    <div class="form-group">
                        <label for="joinPlayerName">ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ:</label>
                        <input type="text" id="joinPlayerName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <div class="form-group">
                        <label for="roomCode">Î∞© ÏΩîÎìú:</label>
                        <input type="text" id="roomCode" placeholder="Î∞© ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="text-transform: uppercase;">
                    </div>
                    <button id="joinRoomBtn" class="btn">Î∞© ÏûÖÏû•</button>
                    <button id="backToSelection2" class="btn" style="background: #666;">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>

                <div id="aiGameForm" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #e0e0e0;">ü§ñ AIÏôÄ ÎåÄÏ†Ñ</h3>
                    <div class="form-group">
                        <label for="aiPlayerName">ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ:</label>
                        <input type="text" id="aiPlayerName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <div class="form-group">
                        <label for="aiDifficulty">AI ÎÇúÏù¥ÎèÑ:</label>
                        <select id="aiDifficulty" style="width: 100%; padding: 12px; background: #222; border: 2px solid #444; color: #fff; font-size: 16px;">
                            <option value="easy">üü¢ Ïâ¨ÏõÄ - ÏôÑÏ†Ñ ÎûúÎç§</option>
                            <option value="normal" selected>üü° Î≥¥ÌÜµ - ÏïΩÍ∞ÑÏùò Ï†ÑÎûµ</option>
                            <option value="hard">üî¥ Ïñ¥Î†§ÏõÄ - ÎòëÎòëÌïú Ï†ÑÎûµ</option>
                        </select>
                    </div>
                    <button id="createAIGameBtn" class="btn">AI Í≤åÏûÑ ÏãúÏûë</button>
                    <button id="backToSelection3" class="btn" style="background: #666;">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑ Î£∞ ÏÑ§Î™Ö -->
        <div class="game-rules">
            <div class="rules-header" onclick="toggleRules()" style="cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <h3 style="color: #00ffff; margin: 0;">üéØ Í≤åÏûÑ Î£∞</h3>
                <span id="rulesToggle" style="color: #00ffff; font-size: 20px; transition: transform 0.3s ease;">‚ñº</span>
            </div>
            <div class="rules-container" id="rulesContainer" style="display: none;">
                <div class="rule-section">
                    <h4 style="color: #ff6b6b;">üìã Í∏∞Î≥∏ Í∑úÏπô</h4>
                    <ul>
                        <li><strong>Ïπ¥Îìú:</strong> 1~9 Ïà´Ïûê Ïπ¥Îìú (Í∞ÅÍ∞Å 1Ïû•Ïî©)</li>
                        <li><strong>ÎùºÏö¥Îìú:</strong> Ï¥ù 9ÎùºÏö¥Îìú ÏßÑÌñâ</li>
                        <li><strong>ÏäπÎ¶¨ Ï°∞Í±¥:</strong> 9ÎùºÏö¥Îìú ÌõÑ ÏäπÏàòÍ∞Ä Îçî ÎßéÏùÄ ÌîåÎ†àÏù¥Ïñ¥ ÏäπÎ¶¨</li>
                    </ul>
                </div>
                
                <div class="rule-section">
                    <h4 style="color: #ffd93d;">‚öîÔ∏è ÏäπÎ∂Ä Í∑úÏπô</h4>
                    <ul>
                        <li><strong>ÏùºÎ∞ò ÏäπÎ∂Ä:</strong> ÌÅ∞ Ïà´ÏûêÍ∞Ä ÏûëÏùÄ Ïà´ÏûêÎ•º Ïù¥ÍπÄ</li>
                        <li><strong>ÌäπÏàò Í∑úÏπô:</strong> <span style="color: #00ffff;">1ÏùÄ 9Î•º Ïù¥ÍπÄ!</span></li>
                        <li><strong>Î¨¥ÏäπÎ∂Ä:</strong> Í∞ôÏùÄ Ïà´ÏûêÏùº Í≤ΩÏö∞ Î¨¥ÏäπÎ∂Ä</li>
                    </ul>
                </div>
                
                <div class="rule-section">
                    <h4 style="color: #6bcf7f;">üéÆ ÌîåÎ†àÏù¥ Î∞©Î≤ï</h4>
                    <ul>
                        <li><strong>Ïπ¥Îìú ÏÑ†ÌÉù:</strong> ÏõêÌïòÎäî Ïà´Ïûê Ïπ¥Îìú ÌÅ¥Î¶≠</li>
                        <li><strong>Ïπ¥Îìú Ï†úÏ∂ú:</strong> "Ïπ¥Îìú Ï†úÏ∂ú" Î≤ÑÌäº ÌÅ¥Î¶≠ÏúºÎ°ú ÌôïÏ†ï</li>
                        <li><strong>Ïπ¥Îìú Î≥ÄÍ≤Ω:</strong> Í∞ôÏùÄ Ïπ¥Îìú Îã§Ïãú ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÑ†ÌÉù Ìï¥Ï†ú</li>
                        <li><strong>AI ÎåÄÏ†Ñ:</strong> Ïª¥Ìì®ÌÑ∞ÏôÄ 1:1 ÎåÄÍ≤∞ Í∞ÄÎä•</li>
                    </ul>
                </div>
                
                <div class="rule-section">
                    <h4 style="color: #a8e6cf;">üí° Ï†ÑÎûµ ÌåÅ</h4>
                    <ul>
                        <li><strong>1 Ïπ¥Îìú:</strong> 9Î•º Ïù¥Í∏∏ Ïàò ÏûàÎäî ÌäπÎ≥ÑÌïú Ïπ¥Îìú</li>
                        <li><strong>ÌÉÄÏù¥Î∞ç:</strong> Ïñ∏Ï†ú 1ÏùÑ Ïì∏ÏßÄÍ∞Ä ÏäπÎ∂ÄÏùò Ïó¥Ïá†</li>
                        <li><strong>Ïã¨Î¶¨Ï†Ñ:</strong> ÏÉÅÎåÄÎ∞©Ïùò Ìå®ÌÑ¥ÏùÑ ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ÎåÄÍ∏∞ ÌôîÎ©¥ -->
        <div id="waiting" class="game-section">
            <div class="lobby">
                <h3 style="margin-bottom: 20px; color: #e0e0e0;">Í≤åÏûÑ ÎåÄÍ∏∞ Ï§ë...</h3>
                <div class="room-info">
                    <h4 style="margin-bottom: 10px; color: #ccc;">Î∞© ÏΩîÎìú:</h4>
                    <div class="room-code" id="displayRoomCode">-</div>
                </div>
                <div class="players-list">
                    <h4 style="margin-bottom: 10px; color: #ccc;">ÌîåÎ†àÏù¥Ïñ¥:</h4>
                    <div id="playersList"></div>
                </div>
                <button id="startGameBtn" class="btn" style="display: none;">Í≤åÏûÑ ÏãúÏûë</button>
            </div>
        </div>

        <!-- Í≤åÏûÑ ÌôîÎ©¥ -->
        <div id="game" class="game-section">
            <div class="game-area">
                <div class="game-info">
                    <div class="score">
                        <h3 id="player1Name">ÌîåÎ†àÏù¥Ïñ¥ 1</h3>
                        <div class="number" id="player1Score">0</div>
                    </div>
                    <div class="round-info">
                        <h3>ÎùºÏö¥Îìú</h3>
                        <div class="round-number" id="currentRound">1</div>
                    </div>
                    <div class="score">
                        <h3 id="player2Name">ÌîåÎ†àÏù¥Ïñ¥ 2</h3>
                        <div class="number" id="player2Score">0</div>
                    </div>
                </div>

                <div class="round-info">
                    <h3>ÌòÑÏû¨ ÌîåÎ†àÏù¥</h3>
                    <div class="current-play">
                        <div class="play-cards">
                            <div class="play-card" id="player1Card">-</div>
                            <div class="play-card" id="player2Card">-</div>
                        </div>
                    </div>
                    <div class="card-submit-section" id="cardSubmitSection" style="display: none; text-align: center; margin-top: 15px;">
                        <button id="submitCardBtn" class="btn" style="background: #00aa00;">Ïπ¥Îìú Ï†úÏ∂ú</button>
                    </div>
                </div>

                <!-- Í≤åÏûÑ ÏßÑÌñâ ÏÉÅÌÉú -->
                <div class="status-bar" id="gameStatus" style="display:none">Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§</div>

                <div class="round-result" id="roundResult" style="display: none;">
                    <h4>ÎùºÏö¥Îìú Í≤∞Í≥º</h4>
                    <div class="reason" id="roundReason"></div>
                </div>

                <!-- ÏÉàÎ°úÏö¥ Ïπ¥Îìú Ìå®Îìú -->
                <div class="card-pad-section">
                    <h3 style="color: #e0e0e0; margin-bottom: 20px; text-align: center;">ÎÇ¥ Ïπ¥Îìú</h3>
                    <div class="card-pad" id="cardPad">
                        <!-- Cards will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑ Ï¢ÖÎ£å ÌôîÎ©¥ -->
        <div id="finished" class="game-section">
            <div class="game-result">
                <h2 id="gameResultTitle">Í≤åÏûÑ Ï¢ÖÎ£å!</h2>
                <div class="final-scores">
                    <div class="final-score">
                        <h3>ÌîåÎ†àÏù¥Ïñ¥ 1</h3>
                        <div class="number" id="finalPlayer1Score">0</div>
                    </div>
                    <div class="final-score">
                        <h3>ÌîåÎ†àÏù¥Ïñ¥ 2</h3>
                        <div class="number" id="finalPlayer2Score">0</div>
                    </div>
                </div>
                <button id="newGameBtn" class="btn">Ïû¨Í≤ΩÍ∏∞</button>
                <button id="backToLobbyBtn" class="btn" style="background: #666;">Î°úÎπÑÎ°ú</button>
            </div>
        </div>

        <!-- ÌíÄÏä§ÌÅ¨Î¶∞ ÏïàÎÇ¥/Í≤∞Í≥º Î™®Îã¨ -->
        <div id="roundModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 999; align-items: center; justify-content: center;">
            <div style="background:#111; border:2px solid #444; padding:24px 32px; color:#fff; min-width:260px; text-align:center;">
                <div id="roundModalText" style="font-size:22px; font-weight:bold; color:#00ffff;">ÏïàÎÇ¥</div>
                <div id="roundModalSub" style="margin-top:8px; color:#ccc; font-size:14px;"></div>
            </div>
        </div>

        <!-- Î©îÏãúÏßÄ ÌëúÏãú ÏòÅÏó≠ -->
        <div id="messageArea"></div>
    </div>

    <script>
        class GameClient {
            constructor() {
                this.playerId = null;
                this.playerName = null;
                this.roomId = null;
                this.currentPlayer = null;
                this.gameState = 'lobby';
                this.selectedCard = null;
                this.ably = null;
                this.channel = null;
                
                this.initializeElements();
                this.attachEventListeners();
                this.showScreen('lobby');
            }
            
            initializeElements() {
                this.elements = {
                    // ÌôîÎ©¥Îì§
                    lobby: document.getElementById('lobby'),
                    waiting: document.getElementById('waiting'),
                    game: document.getElementById('game'),
                    finished: document.getElementById('finished'),
                    
                    // Î°úÎπÑ ÏöîÏÜåÎì§
                    initialSelection: document.getElementById('initialSelection'),
                    createRoomForm: document.getElementById('createRoomForm'),
                    joinRoomForm: document.getElementById('joinRoomForm'),
                    aiGameForm: document.getElementById('aiGameForm'),
                    
                    // ÏûÖÎ†• ÌïÑÎìúÎì§
                    createPlayerName: document.getElementById('createPlayerName'),
                    joinPlayerName: document.getElementById('joinPlayerName'),
                    aiPlayerName: document.getElementById('aiPlayerName'),
                    aiDifficulty: document.getElementById('aiDifficulty'),
                    roomCode: document.getElementById('roomCode'),
                    
                    // Î≤ÑÌäºÎì§
                    showCreateRoom: document.getElementById('showCreateRoom'),
                    showJoinRoom: document.getElementById('showJoinRoom'),
                    showAIGame: document.getElementById('showAIGame'),
                    createRoomBtn: document.getElementById('createRoomBtn'),
                    joinRoomBtn: document.getElementById('joinRoomBtn'),
                    createAIGameBtn: document.getElementById('createAIGameBtn'),
                    backToSelection: document.getElementById('backToSelection'),
                    backToSelection2: document.getElementById('backToSelection2'),
                    backToSelection3: document.getElementById('backToSelection3'),
                    startGameBtn: document.getElementById('startGameBtn'),
                    newGameBtn: document.getElementById('newGameBtn'),
                    backToLobbyBtn: document.getElementById('backToLobbyBtn'),
                    
                    // Í≤åÏûÑ ÏöîÏÜåÎì§
                    displayRoomCode: document.getElementById('displayRoomCode'),
                    playersList: document.getElementById('playersList'),
                    player1Name: document.getElementById('player1Name'),
                    player1Score: document.getElementById('player1Score'),
                    player2Score: document.getElementById('player2Score'),
                    player2Name: document.getElementById('player2Name'),
                    currentRound: document.getElementById('currentRound'),
                    player1Card: document.getElementById('player1Card'),
                    player2Card: document.getElementById('player2Card'),
                    roundResult: document.getElementById('roundResult'),
                    roundReason: document.getElementById('roundReason'),
                    cardsContainer: document.getElementById('cardsContainer'),
                    cardPad: document.getElementById('cardPad'),
                    gameResultTitle: document.getElementById('gameResultTitle'),
                    finalPlayer1Score: document.getElementById('finalPlayer1Score'),
                    finalPlayer2Score: document.getElementById('finalPlayer2Score'),
                    messageArea: document.getElementById('messageArea'),
                    gameStatus: document.getElementById('gameStatus'),
                    roundModal: document.getElementById('roundModal'),
                    roundModalText: document.getElementById('roundModalText'),
                    roundModalSub: document.getElementById('roundModalSub'),
                    
                    // Ïπ¥Îìú Ï†úÏ∂ú Í¥ÄÎ†® ÏöîÏÜåÎì§
                    cardSubmitSection: document.getElementById('cardSubmitSection'),
                    submitCardBtn: document.getElementById('submitCardBtn'),
                    
                    // ÎÇòÍ∞ÄÍ∏∞ Î≤ÑÌäº
                    exitGameBtn: document.getElementById('exitGameBtn')
                };
            }
            
            attachEventListeners() {
                console.log('Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù ÏãúÏûë');
                console.log('newGameBtn ÏöîÏÜå:', this.elements.newGameBtn);
                console.log('backToLobbyBtn ÏöîÏÜå:', this.elements.backToLobbyBtn);
                
                // Î°úÎπÑ Î≤ÑÌäºÎì§
                this.elements.showCreateRoom.addEventListener('click', () => this.showCreateRoomForm());
                this.elements.showJoinRoom.addEventListener('click', () => this.showJoinRoomForm());
                this.elements.showAIGame.addEventListener('click', () => this.showAIGameForm());
                
                // Ìèº Î≤ÑÌäºÎì§
                this.elements.createRoomBtn.addEventListener('click', () => this.createRoom());
                this.elements.joinRoomBtn.addEventListener('click', () => this.joinRoom());
                this.elements.createAIGameBtn.addEventListener('click', () => this.createAIGame());
                
                // Ïπ¥Îìú Ìå®Îìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (Ïπ¥Îìú ÏÑ†ÌÉùÎßå)
                this.elements.cardPad.addEventListener('click', (e) => {
                    console.log('Ïπ¥Îìú Ìå®Îìú ÌÅ¥Î¶≠Îê®:', e.target);
                    if (e.target.classList.contains('card-button') && !e.target.classList.contains('used')) {
                        const cardValue = parseInt(e.target.dataset.card);
                        console.log('Ïπ¥Îìú ÏÑ†ÌÉù ÏãúÎèÑ:', cardValue);
                        this.selectCard(cardValue);
                    } else {
                        console.log('Ïπ¥Îìú ÏÑ†ÌÉù Ï°∞Í±¥ Î∂àÎßåÏ°±:', {
                            hasCardButton: e.target.classList.contains('card-button'),
                            isUsed: e.target.classList.contains('used')
                        });
                    }
                });
                
                // Ïπ¥Îìú Ï†úÏ∂ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                this.elements.submitCardBtn.addEventListener('click', () => {
                    this.submitSelectedCard();
                });
                
                // ÎÇòÍ∞ÄÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                this.elements.exitGameBtn.addEventListener('click', () => {
                    this.backToLobby();
                });
                
                // ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäºÎì§
                this.elements.backToSelection.addEventListener('click', () => this.showInitialSelection());
                this.elements.backToSelection2.addEventListener('click', () => this.showInitialSelection());
                this.elements.backToSelection3.addEventListener('click', () => this.showInitialSelection());
                
                // Í≤åÏûÑ Î≤ÑÌäºÎì§
                this.elements.startGameBtn.addEventListener('click', () => this.startGame());
                
                // Ïû¨Í≤ΩÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                if (this.elements.newGameBtn) {
                    console.log('Ïû¨Í≤ΩÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù ÏÑ±Í≥µ');
                    this.elements.newGameBtn.addEventListener('click', () => {
                        console.log('Ïû¨Í≤ΩÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ìò∏Ï∂úÎê®');
                        this.newGame();
                    });
                } else {
                    console.error('newGameBtn ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                }
                
                // Î°úÎπÑÎ°ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
                if (this.elements.backToLobbyBtn) {
                    console.log('Î°úÎπÑÎ°ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù ÏÑ±Í≥µ');
                    this.elements.backToLobbyBtn.addEventListener('click', () => {
                        console.log('Î°úÎπÑÎ°ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ìò∏Ï∂úÎê®');
                        this.backToLobby();
                    });
                } else {
                    console.error('backToLobbyBtn ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                }
                
                // ÏóîÌÑ∞ÌÇ§ Ï≤òÎ¶¨
                this.elements.createPlayerName.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.createRoom();
                });
                this.elements.joinPlayerName.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.joinRoom();
                });
                this.elements.roomCode.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.joinRoom();
                });
                this.elements.aiPlayerName.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.createAIGame();
                });
            }
            
            async connectAbly() {
                console.log('Ably Ïó∞Í≤∞ ÏãúÎèÑ...');
                
                try {
                    // Ably ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï¥àÍ∏∞Ìôî (Í∞ÑÎã®Ìïú Î∞©Ïãù)
                    this.ably = new Ably.Realtime("qvbjOA.EbbZ6g:lHGCOz5aSbkalenzwn2qRImwpxQul9BKZo3NQmbKw6g");
                    
                    this.ably.connection.once('connected', () => {
                        console.log('Ably Ïó∞Í≤∞Îê®');
                        this.showMessage('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§', 'success');
                    });
                    
                    this.ably.connection.on('disconnected', () => {
                        console.log('Ably Ïó∞Í≤∞ Ï¢ÖÎ£å');
                        this.showMessage('ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§', 'error');
                    });
                    
                    this.ably.connection.on('failed', (error) => {
                        console.error('Ably Ïó∞Í≤∞ Ïã§Ìå®:', error);
                        this.showMessage('ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®', 'error');
                    });
                    
                } catch (error) {
                    console.error('Ably Ïó∞Í≤∞ Ïò§Î•ò:', error);
                    this.showMessage('ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò', 'error');
                }
            }
            
            async subscribeToRoom(roomId) {
                if (!this.ably) return;
                this.channel = this.ably.channels.get(`room:${roomId}`);
                await this.channel.subscribe('game-event', (message) => {
                    const data = message.data;
                    // Î™®Îì† Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏ Ï≤òÎ¶¨ (Ably-only Î™®Îìú)
                    this.handleMessage(data);
                });
            }
            
            handleMessage(data) {
                console.log('Î∞õÏùÄ Î©îÏãúÏßÄ:', data);
                
                switch (data.type) {
                    case 'room_created':
                        this.playerId = data.playerId || this.generatePlayerId();
                        this.roomId = data.roomId;
                        this.currentPlayer = data.player;
                        this.showScreen('waiting');
                        this.updateWaitingDisplay(data.room);
                        this.showMessage('Î∞©Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!', 'success');
                        break;
                        
                    case 'ai_game_started':
                        console.log('AI Í≤åÏûÑ ÏãúÏûë Îç∞Ïù¥ÌÑ∞:', data);
                        this.playerId = data.playerId || this.generatePlayerId();
                        this.roomId = data.roomId;
                        this.currentPlayer = data.player;
                        this.gameState = 'playing'; // Í≤åÏûÑ ÏÉÅÌÉú Î™ÖÏãúÏ†Å ÏÑ§Ï†ï
                        this.showScreen('game');
                        console.log('ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥:', this.currentPlayer);
                        console.log('Î∞© Îç∞Ïù¥ÌÑ∞:', data.room);
                        this.updateGameDisplay(data.room);
                        this.showStartHint();
                        this.updatePlayerNames(data.room.players); // Ïù¥Î¶Ñ Ï¶âÏãú Î∞òÏòÅ
                        this.showMessage('AIÏôÄÏùò Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!', 'success');
                        setTimeout(() => {
                            console.log('Ïπ¥Îìú Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎèÑ');
                            this.updateCardsDisplay(data.room.cards);
                            // Ï∂îÍ∞Ä ÎîîÎ≤ÑÍπÖ
                            console.log('Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà ÏöîÏÜå:', this.elements.cardsContainer);
                            console.log('Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú ÏÉÅÌÉú:', window.getComputedStyle(this.elements.cardsContainer).display);
                            console.log('Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà ÏûêÏãù ÏöîÏÜå Ïàò:', this.elements.cardsContainer.children.length);
                        }, 100);
                        break;
                    // Ably-only ÏÉÅÌÉú ÎèôÍ∏∞Ìôî
                    case 'state':
                        if (data.room) {
                            this._cachedRoom = data.room;
                            this._lastCards = data.room.cards;
                            this._lastCurrentPlay = data.room.currentPlay;
                            this._lastScores = data.room.scores;
                            this._lastRound = data.room.currentRound;
                            // ÎÇ¥ Ìè¨ÏßÄÏÖò ÎèôÍ∏∞Ìôî
                            const me = data.room.players.find(p => p.id === this.playerId);
                            if (me) this.currentPlayer = me;
                            this.updateGameDisplay(data.room);
                        }
                        break;
                        
                    case 'joined_room':
                        this.playerId = data.playerId || this.generatePlayerId();
                        this.roomId = data.roomId;
                        this.currentPlayer = data.player;
                        this.showScreen('waiting');
                        this.updateWaitingDisplay(data.room);
                        this.showMessage('Î∞©Ïóê ÏûÖÏû•ÌñàÏäµÎãàÎã§!', 'success');
                        break;
                        
                    case 'player_joined':
                        this.updateWaitingDisplay(data.room);
                        this.showMessage(`${data.player.name}ÎãòÏù¥ ÏûÖÏû•ÌñàÏäµÎãàÎã§!`, 'success');
                        break;
                    case 'join':
                        // Ìò∏Ïä§Ìä∏Í∞Ä Ï∞∏Í∞ÄÏûê ÏàòÎùΩ ‚Üí state ÏóÖÎç∞Ïù¥Ìä∏, ÏãúÏûë Ï§ÄÎπÑ
                        if (!this.isHost) break;
                        if (!this._cachedRoom) break;
                        const already = this._cachedRoom.players.find(p => p.id === data.player.id);
                        if (!already && this._cachedRoom.players.length < 2) {
                            this._cachedRoom.players.push({ id: data.player.id, name: data.player.name, position: 'player2' });
                            this.channel.publish('game-event', { type: 'player_joined', player: { id: data.player.id, name: data.player.name }, room: this._cachedRoom });
                            // Îëê Î™Ö Î™®Ïù¥Î©¥ Î∞îÎ°ú ÏãúÏûë
                            this._cachedRoom.gameState = 'playing';
                            this.channel.publish('game-event', { type: 'game_started', room: this._cachedRoom });
                        }
                        break;
                        
                    case 'game_started':
                        this.showScreen('game');
                        this._cachedRoom = data.room;
                        // ÎÇ¥ Ìè¨ÏßÄÏÖò ÏÑ§Ï†ï
                        const me = data.room.players.find(p => p.id === this.playerId);
                        if (me) this.currentPlayer = me;
                        this.updateGameDisplay(data.room);
                        this.showStartHint();
                        this.showMessage('Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!', 'success');
                        break;
                        
                    case 'card_played':
                        this.updateCurrentPlay(data.currentPlay);
                        this.updateCardsDisplay(data.cards);
                        if (data.playerId === this.playerId) {
                            this.selectedCard = null;
                        }
                        break;
                        
                    case 'round_result':
                        this.updateScores(data.scores);
                        this.updateRound(data.currentRound);
                        this.showRoundResult(data.result);
                        this.updateStatusOnRoundResult(data.result);
                        break;
                        
                    case 'game_finished':
                        this._cachedRoom = data.room; // room ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                        this.resetGameForReplay(); // Í≤åÏûÑ ÏÉÅÌÉúÎßå Ï¥àÍ∏∞Ìôî, Ïó∞Í≤∞ Ï†ïÎ≥¥Îäî Ïú†ÏßÄ
                        this.showScreen('finished');
                        this.updateGameResult(data.result);
                        this.showMessage('Í≤åÏûÑÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
                        break;
                        
                    case 'error':
                        this.showMessage(data.message, 'error');
                        break;
                }
            }
            
            showScreen(screen) {
                document.querySelectorAll('.game-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(screen).classList.add('active');
                this.gameState = screen;
                
                // ÎÇòÍ∞ÄÍ∏∞ Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
                if (this.elements.exitGameBtn) {
                    if (screen === 'game' || screen === 'waiting' || screen === 'finished') {
                        this.elements.exitGameBtn.style.display = 'block';
                    } else {
                        this.elements.exitGameBtn.style.display = 'none';
                    }
                }
                
                // Í≤åÏûÑ ÌôîÎ©¥ ÏßÑÏûÖ Ïãú Í∑úÏπô ÏûêÎèô Îã´Í∏∞
                if (screen === 'game' || screen === 'waiting' || screen === 'finished') {
                    closeRulesOnGameStart();
                }
                
                // Í≤åÏûÑ ÌôîÎ©¥Ïùº Îïå Ïπ¥Îìú Ìå®Îìú Í∞ïÏ†ú ÌëúÏãú
                if (screen === 'game') {
                    const cardPadSection = document.querySelector('.card-pad-section');
                    if (cardPadSection) {
                        cardPadSection.style.display = 'block';
                        cardPadSection.style.visibility = 'visible';
                        console.log('Í≤åÏûÑ ÌôîÎ©¥ ÌëúÏãú - Ïπ¥Îìú Ìå®Îìú Í∞ïÏ†ú ÌëúÏãú');
                    }
                }
            }
            
            showInitialSelection() {
                this.elements.initialSelection.style.display = 'block';
                this.elements.createRoomForm.style.display = 'none';
                this.elements.joinRoomForm.style.display = 'none';
                this.elements.aiGameForm.style.display = 'none';
            }
            
            showCreateRoomForm() {
                this.elements.initialSelection.style.display = 'none';
                this.elements.createRoomForm.style.display = 'block';
                this.elements.joinRoomForm.style.display = 'none';
                this.elements.aiGameForm.style.display = 'none';
                this.elements.createPlayerName.focus();
            }
            
            showJoinRoomForm() {
                this.elements.initialSelection.style.display = 'none';
                this.elements.createRoomForm.style.display = 'none';
                this.elements.joinRoomForm.style.display = 'block';
                this.elements.aiGameForm.style.display = 'none';
                this.elements.joinPlayerName.focus();
            }
            
            showAIGameForm() {
                this.elements.initialSelection.style.display = 'none';
                this.elements.createRoomForm.style.display = 'none';
                this.elements.joinRoomForm.style.display = 'none';
                this.elements.aiGameForm.style.display = 'block';
                this.elements.aiPlayerName.focus();
            }
            
            async createRoom() {
                const playerName = this.elements.createPlayerName.value.trim();
                if (!playerName) { this.showMessage('ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error'); return; }
                this.playerName = playerName;
                this.playerId = this.generatePlayerId();
                await this.connectAbly();

                // Ìò∏Ïä§Ìä∏Í∞Ä Î∞©ÏùÑ ÎßåÎì†Îã§
                this.roomId = (Math.random().toString(36).slice(2, 6).toUpperCase());
                await this.subscribeToRoom(this.roomId);
                this.isHost = true;

                const me = { id: this.playerId, name: this.playerName, position: 'player1' };
                const room = {
                    id: this.roomId,
                    players: [me],
                    cards: { player1: [1,2,3,4,5,6,7,8,9], player2: [1,2,3,4,5,6,7,8,9] },
                    currentPlay: { player1: null, player2: null },
                    scores: { player1: 0, player2: 0 },
                    currentRound: 1,
                    maxRounds: 9,
                    gameState: 'lobby',
                    isAIGame: false
                };
                this._cachedRoom = room;
                this.currentPlayer = me;
                this.showScreen('waiting');
                this.updateWaitingDisplay(room);
                // Î∞© ÏΩîÎìú ÌëúÍ∏∞
                this.elements.displayRoomCode.textContent = this.roomId;
                // ÏÉÅÌÉú Î∞©ÏÜ°
                this.channel.publish('game-event', { type: 'state', room });
            }
            
            async joinRoom() {
                const playerName = this.elements.joinPlayerName.value.trim();
                const roomCode = this.elements.roomCode.value.trim().toUpperCase();
                if (!playerName || !roomCode) { this.showMessage('Ïù¥Î¶ÑÍ≥º Î∞© ÏΩîÎìúÎ•º Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error'); return; }
                this.playerName = playerName;
                this.playerId = this.generatePlayerId();
                this.roomId = roomCode;
                await this.connectAbly();
                await this.subscribeToRoom(this.roomId);
                // Ï∞∏Í∞Ä ÏöîÏ≤≠
                this.channel.publish('game-event', { type: 'join', player: { id: this.playerId, name: this.playerName } });
                this.showScreen('waiting');
                this.elements.displayRoomCode.textContent = this.roomId;
            }
            
            async createAIGame() {
                const playerName = this.elements.aiPlayerName.value.trim();
                const difficulty = this.elements.aiDifficulty.value;
                if (!playerName) { this.showMessage('ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error'); return; }
                this.playerName = playerName;
                this.playerId = this.generatePlayerId();
                await this.connectAbly();
                // Î°úÏª¨ Î∞© ÏÉùÏÑ± (Ably-only)
                this.roomId = 'room-' + Math.random().toString(36).slice(2, 6).toUpperCase();
                await this.subscribeToRoom(this.roomId);

                const aiPlayer = { id: 'ai_player', name: 'AIü§ñ', position: 'player2' };
                const me = { id: this.playerId, name: this.playerName, position: 'player1' };
                const room = {
                    id: this.roomId,
                    players: [me, aiPlayer],
                    cards: { player1: [1,2,3,4,5,6,7,8,9], player2: [1,2,3,4,5,6,7,8,9] },
                    currentPlay: { player1: null, player2: null },
                    scores: { player1: 0, player2: 0 },
                    currentRound: 1,
                    maxRounds: 9,
                    gameState: 'playing',
                    isAIGame: true,
                    aiDifficulty: difficulty
                };

                this.currentPlayer = me;
                this.handleMessage({
                    type: 'ai_game_started',
                    playerId: this.playerId,
                    roomId: this.roomId,
                    player: me,
                    room
                });

                // Ï¥àÍ∏∞ ÏÉÅÌÉú Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏
                this.channel.publish('game-event', { type: 'state', room });
            }
            
            async startGame() {
                this.showMessage('ÌòÑÏû¨ Î≤ÑÏ†ÑÏùÄ Ably-only AI Î™®ÎìúÎßå ÏßÄÏõêÌï©ÎãàÎã§', 'error');
            }
            
            async playCard(card) {
                // Ably-only: Î°úÏª¨ ÏÉÅÌÉúÎ•º Í∞±Ïã†ÌïòÍ≥† Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏
                if (!this.roomId || !this.channel) return;
                // Í≤åÏûÑ Ï¢ÖÎ£å ÌõÑÏóêÎäî Ïπ¥Îìú Ï†úÏ∂ú Î∂àÍ∞Ä
                if (this._cachedRoom && this._cachedRoom.gameState === 'finished') return;
                const myPos = this.currentPlayer?.position;
                if (!myPos) return;

                // ÌòÑÏû¨ UIÏóêÏÑú room Ïú†Ï∂îÍ∞Ä ÌïÑÏöîÌïòÎØÄÎ°ú stateÎ•º ÌôîÎ©¥ ÏöîÏÜåÏóêÏÑú Ïû¨Íµ¨ÏÑ±
                const room = this._cachedRoom || null;
                const rebuildFromUI = () => {
                    return {
                        id: this.roomId,
                        players: [
                            { id: this.playerId, name: this.playerName, position: 'player1' },
                            { id: 'ai_player', name: 'AIü§ñ', position: 'player2' }
                        ],
                        cards: this._lastCards || { player1: [1,2,3,4,5,6,7,8,9], player2: [1,2,3,4,5,6,7,8,9] },
                        currentPlay: this._lastCurrentPlay || { player1: null, player2: null },
                        scores: this._lastScores || { player1: 0, player2: 0 },
                        currentRound: this._lastRound || 1,
                        maxRounds: 9,
                        gameState: 'playing',
                        isAIGame: true
                    };
                };
                const s = room || rebuildFromUI();

                if (!s.cards[myPos].includes(card) || s.currentPlay[myPos] !== null) { return; }
                s.currentPlay[myPos] = card;
                s.cards[myPos] = s.cards[myPos].filter(c => c !== card);

                // AI ÌÑ¥: Î©ÄÌã∞ÌîåÎ†àÏù¥ÏóêÏÑúÎäî Í∏àÏßÄ
                if (s.isAIGame && s.currentPlay.player2 === null && myPos === 'player1') {
                    const avail = s.cards.player2;
                    const aiCard = avail[Math.floor(Math.random() * avail.length)];
                    s.currentPlay.player2 = aiCard;
                    s.cards.player2 = s.cards.player2.filter(c => c !== aiCard);
                }

                // ÏñëÏ∏°Ïù¥ ÎÉàÏúºÎ©¥ ÌåêÏ†ï
                if (s.currentPlay.player1 !== null && s.currentPlay.player2 !== null) {
                    const a = s.currentPlay.player1, b = s.currentPlay.player2;
                    let winner = 'tie';
                    if (a === 1 && b === 9) winner = 'player1';
                    else if (b === 1 && a === 9) winner = 'player2';
                    else if (a > b) winner = 'player1';
                    else if (b > a) winner = 'player2';

                    if (winner === 'player1') s.scores.player1 += 1;
                    if (winner === 'player2') s.scores.player2 += 1;

                    const result = { round: s.currentRound, player1Card: a, player2Card: b, winner };
                    this.channel.publish('game-event', { type: 'round_result', result, scores: s.scores, currentRound: s.currentRound + 1, gameState: s.gameState });

                    s.currentPlay = { player1: null, player2: null };
                    s.currentRound += 1;
                    if (s.currentRound > s.maxRounds) {
                        s.gameState = 'finished';
                        const finalWinner = s.scores.player1 === s.scores.player2 ? 'tie' : (s.scores.player1 > s.scores.player2 ? 'player1' : 'player2');
                        this.channel.publish('game-event', { type: 'game_finished', result: { winner: finalWinner, scores: s.scores }, room: s });
                    }
                }

                // ÏÉÅÌÉú ÎèôÍ∏∞Ìôî
                this.channel.publish('game-event', { type: 'state', room: s });
                // Î°úÏª¨ Ï∫êÏãúÏôÄ UI Í∞±Ïã†
                this._cachedRoom = s;
                this.updateGameDisplay(s);
            }
            
            updateWaitingDisplay(room) {
                this.elements.displayRoomCode.textContent = room.id || this.roomId;
                
                const playersList = this.elements.playersList;
                playersList.innerHTML = '';
                
                room.players.forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player';
                    playerDiv.textContent = `${player.name} (${player.position})`;
                    playersList.appendChild(playerDiv);
                });
                
                // Í≤åÏûÑ ÏãúÏûë Î≤ÑÌäº ÌëúÏãú (Î∞©Ïû•Îßå)
                if (room.players.length >= 2 && !room.isAIGame) {
                    this.elements.startGameBtn.style.display = 'block';
                } else {
                    this.elements.startGameBtn.style.display = 'none';
                }
            }
            
            updateGameDisplay(room) {
                this.updateScores(room.scores);
                this.updateRound(room.currentRound);
                this.updateCurrentPlay(room.currentPlay);
                this.updateCardsDisplay(room.cards);
                this.updatePlayerNames(room.players);
            }
            
            updatePlayerNames(players) {
                console.log('updatePlayerNames Ìò∏Ï∂ú', { players, playerId: this.playerId, currentPlayer: this.currentPlayer });
                if (players && players.length >= 2) {
                    const p1 = players.find(p => p.position === 'player1') || players[0];
                    const p2 = players.find(p => p.position === 'player2') || players[1];
                    if (this.elements.player1Name) {
                        this.elements.player1Name.textContent = p1?.name || this.playerName || 'ÌîåÎ†àÏù¥Ïñ¥ 1';
                    }
                    if (this.elements.player2Name) {
                        this.elements.player2Name.textContent = (p2 && p2.id === 'ai_player') ? 'AIü§ñ' : (p2?.name || 'ÌîåÎ†àÏù¥Ïñ¥ 2');
                    }
                } else {
                    // Ìè¥Î∞±: ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Î≥¥Ïú† Ïù¥Î¶Ñ ÏÇ¨Ïö©
                    if (this.elements.player1Name) this.elements.player1Name.textContent = this.playerName || 'ÌîåÎ†àÏù¥Ïñ¥ 1';
                    if (this.elements.player2Name) this.elements.player2Name.textContent = 'AIü§ñ';
                }
            }
            
            updateScores(scores) {
                this.elements.player1Score.textContent = scores.player1;
                this.elements.player2Score.textContent = scores.player2;
            }
            
            updateRound(round) {
                this.elements.currentRound.textContent = round;
            }
            
            updateCurrentPlay(currentPlay) {
                // ÎÇ¥ Ïπ¥ÎìúÎßå Î≥¥Ïó¨Ï£ºÍ≥†, ÏÉÅÎåÄ Ïπ¥ÎìúÎäî Ìï≠ÏÉÅ '-' Î°ú Í∞ÄÎ¶∞Îã§
                const myPos = this.currentPlayer?.position;
                const oppPos = myPos === 'player1' ? 'player2' : 'player1';

                // ÎÇ¥ Ïπ¥Îìú ÌëúÏãú
                this.elements[myPos + 'Card'].textContent = currentPlay[myPos] || '-';
                this.elements[myPos + 'Card'].className = 'play-card' + (currentPlay[myPos] ? ' played' : '');

                // ÏÉÅÎåÄ Ïπ¥Îìú ÎπÑÍ≥µÍ∞ú Ï≤òÎ¶¨
                this.elements[oppPos + 'Card'].textContent = '-';
                this.elements[oppPos + 'Card'].className = 'play-card';
            }
            
            updateCardsDisplay(cards) {
                console.log('updateCardsDisplay Ìò∏Ï∂úÎê®:', { 
                    cards, 
                    currentPlayer: this.currentPlayer, 
                    gameState: this.gameState
                });
                
                const playerPosition = this.currentPlayer?.position;
                console.log('ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò:', playerPosition);
                
                if (!playerPosition) {
                    console.log('ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπòÍ∞Ä ÏóÜÏùå');
                    return;
                }
                
                if (!cards || !cards[playerPosition]) {
                    console.log('Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùå:', { cards, playerPosition });
                    return;
                }
                
                console.log('ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïπ¥Îìú:', cards[playerPosition]);
                
                // Ïπ¥Îìú Ìå®Îìú ÏóÖÎç∞Ïù¥Ìä∏
                this.updateCardPad(cards[playerPosition]);
            }

            updateCardPad(availableCards) {
                // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïπ¥ÎìúÎßå ÏùºÎ†¨Î°ú Îã§Ïãú Í∑∏Î¶º (ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÎäî ÏïÑÏòà Ï†úÍ±∞)
                const pad = this.elements.cardPad;
                if (!pad) {
                    console.error('cardPad ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                    return;
                }
                console.log('Ïπ¥Îìú Ìå®Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë - ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïπ¥Îìú:', availableCards);
                pad.innerHTML = '';
                const sorted = [...availableCards].sort((a,b) => a - b);
                sorted.forEach(card => {
                    const btn = document.createElement('div');
                    btn.className = 'card-button';
                    btn.dataset.card = String(card);
                    btn.textContent = String(card);
                    pad.appendChild(btn);
                });
                console.log('Ïπ¥Îìú Ìå®Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å - ÎÇ®ÏùÄ Ïπ¥Îìú:', sorted);
                console.log('ÏÉùÏÑ±Îêú Ïπ¥Îìú Î≤ÑÌäº Ïàò:', pad.children.length);
            }
            
            selectCard(card) {
                console.log('Ïπ¥Îìú ÏÑ†ÌÉùÎê®:', card);
                
                // Í∞ôÏùÄ Ïπ¥ÎìúÎ•º Îã§Ïãú ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÑ†ÌÉù Ìï¥Ï†ú
                if (this.selectedCard === card) {
                    this.clearCardSelection();
                    return;
                }
                
                // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
                if (this.selectedCard) {
                    const prevBtn = this.elements.cardPad.querySelector(`[data-card="${this.selectedCard}"]`);
                    if (prevBtn) prevBtn.classList.remove('selected');
                }
                
                // ÏÉà Ïπ¥Îìú ÏÑ†ÌÉù
                this.selectedCard = card;
                const btn = this.elements.cardPad.querySelector(`[data-card="${card}"]`);
                if (btn) btn.classList.add('selected');
                
                // ÌòÑÏû¨ ÌîåÎ†àÏù¥ ÏÑπÏÖòÏóê ÏÑ†ÌÉùÌïú Ïπ¥Îìú ÌëúÏãú
                if (this.elements.player1Card) {
                    this.elements.player1Card.textContent = card;
                    this.elements.player1Card.classList.add('played');
                }
                
                // Ï†úÏ∂ú ÏÑπÏÖò ÌëúÏãú
                if (this.elements.cardSubmitSection) {
                    this.elements.cardSubmitSection.style.display = 'block';
                    console.log('Ïπ¥Îìú Ï†úÏ∂ú ÏÑπÏÖò ÌëúÏãúÎê®');
                } else {
                    console.error('cardSubmitSection ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                }
            }
            
            clearCardSelection() {
                console.log('Ïπ¥Îìú ÏÑ†ÌÉù Ìï¥Ï†ú');
                
                // ÏÑ†ÌÉù Ìï¥Ï†ú
                if (this.selectedCard) {
                    const btn = this.elements.cardPad.querySelector(`[data-card="${this.selectedCard}"]`);
                    if (btn) btn.classList.remove('selected');
                }
                
                // ÌòÑÏû¨ ÌîåÎ†àÏù¥ ÏÑπÏÖò Ï¥àÍ∏∞Ìôî
                if (this.elements.player1Card) {
                    this.elements.player1Card.textContent = '-';
                    this.elements.player1Card.classList.remove('played');
                }
                
                // Ï†úÏ∂ú ÏÑπÏÖò Ïà®ÍπÄ
                this.elements.cardSubmitSection.style.display = 'none';
                this.selectedCard = null;
            }
            
            submitSelectedCard() {
                if (!this.selectedCard) return;
                console.log('Ïπ¥Îìú Ï†úÏ∂úÎê®:', this.selectedCard);
                
                // Ïπ¥Îìú Ï†úÏ∂ú Ïã§Ìñâ
                this.playCard(this.selectedCard);
                
                // Ï†úÏ∂ú ÏÑπÏÖò Ïà®ÍπÄ
                this.elements.cardSubmitSection.style.display = 'none';
                this.selectedCard = null;
            }
            
            
            showRoundResult(result) {
                // Ïù¥Î¶Ñ Í∞ÄÏ†∏Ïò§Í∏∞
                const name1 = this.elements.player1Name ? this.elements.player1Name.textContent : 'ÌîåÎ†àÏù¥Ïñ¥ 1';
                const name2 = this.elements.player2Name ? this.elements.player2Name.textContent : 'ÌîåÎ†àÏù¥Ïñ¥ 2';

                const winnerText = result.winner === 'tie' ? 'Î¨¥ÏäπÎ∂Ä' : (result.winner === 'player1' ? `${name1} ÎãòÏù¥ ÏäπÎ¶¨ÌñàÏäµÎãàÎã§!` : `${name2} ÎãòÏù¥ ÏäπÎ¶¨ÌñàÏäµÎãàÎã§!`);
                this.elements.roundReason.textContent = winnerText;

                // Í≤åÏûÑ Ï¢ÖÎ£å ÏãúÏóêÎäî ÏäπÎ∂Ä Í≤∞Í≥º ÌåùÏóÖÏùÑ ÌëúÏãúÌïòÏßÄ ÏïäÏùå
                if (this._cachedRoom && this._cachedRoom.gameState === 'finished') {
                    return;
                }

                // ÌåùÏóÖ: ÏäπÌå® ÏïàÎÇ¥ ‚Üí 3,2,1 ‚Üí Îã§Ïùå Ïπ¥ÎìúÎ•º ÎÇ¥Ï£ºÏÑ∏Ïöî
                const steps = [
                    { title: winnerText, sub: '' },
                    { title: '3', sub: '' },
                    { title: '2', sub: '' },
                    { title: '1', sub: '' },
                    { title: 'Îã§Ïùå Ïπ¥ÎìúÎ•º ÎÇ¥Ï£ºÏÑ∏Ïöî', sub: '' }
                ];
                // Í∞Å Îã®Í≥ÑÎ≥Ñ ÏßÄÏÜç ÏãúÍ∞Ñ(ms)
                const durations = [
                    1500, // ÏäπÏûê ÏïàÎÇ¥Î•º Îçî Í∏∏Í≤å
                    500,  // '3'
                    500,  // '2'
                    500,  // '1'
                    900   // 'Îã§Ïùå Ïπ¥ÎìúÎ•º ÎÇ¥Ï£ºÏÑ∏Ïöî'
                ];
                let idx = 0;
                const run = () => {
                    const s = steps[idx];
                    // ÎßàÏßÄÎßâ Îã®Í≥ÑÏóêÏÑú Ïù¥Ï†Ñ Ïπ¥Îìú ÌëúÏãúÎ•º ÏßÄÏõÄ
                    if (idx === steps.length - 1) {
                        this.clearCurrentPlay();
                    }
                    this.elements.roundModalText.textContent = s.title;
                    this.elements.roundModalSub.textContent = s.sub;
                    this.elements.roundModal.style.display = 'flex';
                    idx++;
                    if (idx < steps.length) {
                        setTimeout(run, durations[idx - 1]);
                    } else {
                        setTimeout(() => { this.elements.roundModal.style.display = 'none'; }, 700);
                    }
                };
                run();
            }

            clearCurrentPlay() {
                if (this.elements.player1Card) {
                    this.elements.player1Card.textContent = '-';
                    this.elements.player1Card.className = 'play-card';
                }
                if (this.elements.player2Card) {
                    this.elements.player2Card.textContent = '-';
                    this.elements.player2Card.className = 'play-card';
                }
            }

            setGameStatus(text) {
                if (this.elements.gameStatus) {
                    this.elements.gameStatus.textContent = text;
                }
            }

            showStartHint() {
                // ÏãúÏûë ÏïàÎÇ¥ ÌåùÏóÖ ÏãúÌÄÄÏä§
                const steps = [
                    { title: 'Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§!', sub: '' },
                    { title: 'ÌïòÎÇòÏùò Ïà´Ïûê Ïπ¥ÎìúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', sub: '' }
                ];
                let i = 0;
                const run = () => {
                    const s = steps[i];
                    this.elements.roundModalText.textContent = s.title;
                    this.elements.roundModalSub.textContent = s.sub;
                    this.elements.roundModal.style.display = 'flex';
                    i++;
                    if (i < steps.length) {
                        setTimeout(run, 700);
                    } else {
                        setTimeout(() => { this.elements.roundModal.style.display = 'none'; }, 900);
                    }
                };
                run();
            }

            updateStatusOnRoundResult(result) {
                if (!this.elements.gameStatus) return;
                if (result.winner === 'tie') {
                    this.setGameStatus('Í≤∞Í≥ºÎäî Î¨¥ÏäπÎ∂Ä ÏûÖÎãàÎã§');
                } else {
                    const iAmP1 = this.currentPlayer?.position === 'player1';
                    const didIWin = (iAmP1 && result.winner === 'player1') || (!iAmP1 && result.winner === 'player2');
                    if (didIWin) {
                        this.setGameStatus('ÏäπÎ¶¨ÌñàÏäµÎãàÎã§!');
                    } else {
                        this.setGameStatus('Ìå®Î∞∞ÏûÖÎãàÎã§. ÏÉÅÎåÄÎ∞©Ïù¥ Îçî ÌÅ∞ ÏàòÎ•º ÎÉàÏäµÎãàÎã§.');
                    }
                }
            }
            
            updateGameResult(result) {
                this.elements.finalPlayer1Score.textContent = result.scores.player1;
                this.elements.finalPlayer2Score.textContent = result.scores.player2;
                
                // Ïã§Ï†ú ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                const name1 = this.elements.player1Name ? this.elements.player1Name.textContent : 'ÌîåÎ†àÏù¥Ïñ¥ 1';
                const name2 = this.elements.player2Name ? this.elements.player2Name.textContent : 'ÌîåÎ†àÏù¥Ïñ¥ 2';
                
                if (result.winner === 'tie') {
                    this.elements.gameResultTitle.textContent = 'Î¨¥ÏäπÎ∂Ä!';
                } else if (result.winner === 'player1') {
                    this.elements.gameResultTitle.textContent = `${name1} ÏäπÎ¶¨!`;
                } else {
                    this.elements.gameResultTitle.textContent = `${name2} ÏäπÎ¶¨!`;
                }
            }
            
            newGame() {
                console.log('Ïû¨Í≤ΩÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                console.log('ÌòÑÏû¨ _cachedRoom:', this._cachedRoom);
                console.log('ÌòÑÏû¨ roomId:', this.roomId);
                console.log('ÌòÑÏû¨ isHost:', this.isHost);
                
                // _cachedRoomÏù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Ï†ïÎ≥¥Î°ú Ïû¨ÏÉùÏÑ± ÏãúÎèÑ
                if (!this._cachedRoom) {
                    console.log('_cachedRoomÏù¥ ÏóÜÏùå - Í∏∞Î≥∏ Ï†ïÎ≥¥Î°ú Ïû¨ÏÉùÏÑ± ÏãúÎèÑ');
                    if (this.roomId && this.channel) {
                        // Î©ÄÌã∞ÌîåÎ†àÏù¥Î°ú Í∞ÄÏ†ïÌïòÍ≥† Ïû¨ÏÉùÏÑ±
                        const newRoom = {
                            id: this.roomId,
                            players: [
                                { id: this.playerId, name: this.playerName, position: 'player1' },
                                { id: 'unknown', name: 'ÏÉÅÎåÄÎ∞©', position: 'player2' }
                            ],
                            cards: { player1: [1,2,3,4,5,6,7,8,9], player2: [1,2,3,4,5,6,7,8,9] },
                            currentPlay: { player1: null, player2: null },
                            scores: { player1: 0, player2: 0 },
                            currentRound: 1,
                            maxRounds: 9,
                            gameState: 'playing',
                            isAIGame: false
                        };
                        this._cachedRoom = newRoom;
                        this.channel.publish('game-event', { type: 'state', room: newRoom });
                        this.showScreen('game');
                        this.updateGameDisplay(newRoom);
                        this.showStartHint();
                        return;
                    } else {
                        console.log('roomIdÎÇò channelÏù¥ ÏóÜÏùå - Î©îÏù∏ÏúºÎ°ú Ïù¥Îèô');
                        this.backToLobby();
                        return;
                    }
                }
                
                // Ïû¨Í≤ΩÍ∏∞ ÏãúÏûë
                if (this._cachedRoom && this._cachedRoom.isAIGame) {
                    console.log('AI Í≤åÏûÑ Ïû¨Í≤ΩÍ∏∞ ÏãúÏûë');
                    // AI Í≤åÏûÑ: ÏÉà Î∞© ÏÉùÏÑ±
                    this.createAIGame();
                } else if (this._cachedRoom && !this._cachedRoom.isAIGame) {
                    console.log('Î©ÄÌã∞ÌîåÎ†àÏù¥ Ïû¨Í≤ΩÍ∏∞ ÏãúÏûë');
                    // Î©ÄÌã∞ÌîåÎ†àÏù¥: Í∏∞Ï°¥ Î∞©ÏóêÏÑú ÏÉà Í≤åÏûÑ ÏãúÏûë
                    if (!this.channel) {
                        console.log('Ï±ÑÎÑêÏù¥ ÏóÜÏùå');
                        return;
                    }
                    
                    const newRoom = {
                        ...this._cachedRoom,
                        cards: { player1: [1,2,3,4,5,6,7,8,9], player2: [1,2,3,4,5,6,7,8,9] },
                        currentPlay: { player1: null, player2: null },
                        scores: { player1: 0, player2: 0 },
                        currentRound: 1,
                        gameState: 'playing'
                    };
                    
                    this._cachedRoom = newRoom;
                    this.channel.publish('game-event', { type: 'state', room: newRoom });
                    this.showScreen('game'); // Í≤åÏûÑ ÌôîÎ©¥ÏúºÎ°ú Ïù¥Îèô
                    this.updateGameDisplay(newRoom);
                    this.showStartHint();
                }
            }
            
            backToLobby() {
                console.log('Î°úÎπÑÎ°ú Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                // Î∞© ÎÇòÍ∞ÄÍ∏∞: Ï±ÑÎÑê Íµ¨ÎèÖ Ìï¥Ï†ú ÌõÑ Î©îÏù∏ÏúºÎ°ú Ïù¥Îèô (Î©ÄÌã∞ÌîåÎ†àÏù¥ + AI Î™®Îëê)
                if (this.channel) {
                    this.channel.unsubscribe();
                    this.channel = null;
                }
                this.resetGame();
                this.showScreen('lobby'); // Î°úÎπÑ ÌôîÎ©¥ÏúºÎ°ú ÌôïÏã§Ìûà Ï†ÑÌôò
            }
            
            resetGame() {
                console.log('resetGame Ìò∏Ï∂úÎê® - Î™®Îì† ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî');
                if (this.ably) {
                    this.ably.close();
                    this.ably = null;
                }
                if (this.channel) {
                    this.channel.unsubscribe();
                    this.channel = null;
                }
                
                this.playerId = null;
                this.playerName = null;
                this.roomId = null;
                this.currentPlayer = null;
                this.selectedCard = null;
                this.gameState = 'lobby';
                this._cachedRoom = null;
                this._lastCards = null;
                this._lastCurrentPlay = null;
                this._lastScores = null;
                this._lastRound = null;
                this.isHost = false;
                
                this.elements.createPlayerName.value = '';
                this.elements.joinPlayerName.value = '';
                this.elements.aiPlayerName.value = '';
                this.elements.roomCode.value = '';
                this.showInitialSelection();
            }
            
            // Í≤åÏûÑ Ï¢ÖÎ£å Ïãú ÏÉÅÌÉúÎßå Ï¥àÍ∏∞Ìôî (Ïû¨Í≤ΩÍ∏∞ ÏúÑÌï¥ Ïó∞Í≤∞ Ï†ïÎ≥¥Îäî Ïú†ÏßÄ)
            resetGameForReplay() {
                console.log('resetGameForReplay Ìò∏Ï∂úÎê® - Í≤åÏûÑ ÏÉÅÌÉúÎßå Ï¥àÍ∏∞Ìôî');
                this.selectedCard = null;
                this.gameState = 'lobby';
                this._lastCards = null;
                this._lastCurrentPlay = null;
                this._lastScores = null;
                this._lastRound = null;
                
                // Ïó∞Í≤∞ Ï†ïÎ≥¥Îäî Ïú†ÏßÄ (playerId, playerName, roomId, channel, ably, currentPlayer, isHost)
                // _cachedRoomÏùÄ game_finishedÏóêÏÑú ÏóÖÎç∞Ïù¥Ìä∏Îê®
            }
            
            generatePlayerId() {
                return 'player_' + Math.random().toString(36).substr(2, 9);
            }
            
            showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = message;
                
                this.elements.messageArea.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.parentNode.removeChild(messageDiv);
                        }
                    }, 300);
                }, 3000);
            }
        }
        
        const gameClient = new GameClient();
    </script>
</body>
</html>
